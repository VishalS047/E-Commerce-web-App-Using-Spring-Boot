<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head th:replace="fragments :: page_header('Products - Shopify Admin')"></head>

<body>
		<div th:replace="navigationfragment ::  menu"></div>
		
		<div class="container-fluid">
		
			<h1 class="text-center">Manage Products</h1>
			<a th:href="@{/products/newproduct}"><i class="fas fa-folder-plus fa-2x mr-2" ></i></a>
			&nbsp;
			<a th:href="@{/product/export/csv}"><i class="fas fa-file-csv fa-2x" style="color:green;"></i></a>			
		</div>
				
		<!-- FOR SHOWING MESSAGES  -->
		<div th:if="${message!=null}" class="alert alert-success text-center m-3">
			[[${message}]]
		</div>
		
		
		<div th:replace="fragments :: searchForm('/products/page/1')"></div>
		
		
		<div class="full-details">
			
				<div  class="table-responsive-xl container-fluid">
			
			<table class="table table-dark table-striped table-bordered table-hover text-center">
			
				<thead>
					<tr>
						<th>ID</th>
						<th>PRODUCT IMAGE</th>
						<th>PRODUCT NAME</th>
						<th>CATEGORY</th>
						<th>BRAND</th>
						<th>ENABLED</th>
					</tr>
				</thead>
				
				<tbody>
					<tr th:each=" product : ${listAllProducts}">
						
						<td style="font-weight: 800">[[${product.id}]]</td>
						
						<td>
							
							<img th:src="@{${product.getMainImagePath}}" class="image-fluid" style="width: 120px; height: 90px" alt="Main Image Preview" />
						
						</td>
						
						<td style="font-weight: 800">
						
							<a class="view-detail" th:href="@{'/product/detail/' + ${product.id}}" title="View Details">[[${product.name}]]</a></td>
						
						<td style="font-weight: 800">[[${product.category.name}]]</td>
						
						<td style="font-weight: 800">[[${product.brand.brandName}]]</td>
						
						<td>
						
							<a th:if="${product.enabled == true}" th:href="@{'/product/' + ${product.id} +'/enabled/false'}" title="Disable this product" class="fas fa-check-circle colorEnabled"></a>
							
							<a th:if="${product.enabled == false}" th:href="@{'/product/' + ${product.id} +'/enabled/true'}" title="Enable this product" class="fas fa-times colorDisabled"></a>
						
						</td>
						
						<td>
						
							<a class="fas fa-file-alt fa-1x colorView view-detail" th:href="@{'/product/detail/' + ${product.id}}" title="View Details">Title</a>
						
							 &nbsp;
						
							<a th:href="@{'/product/edit/' + ${product.id}}" class="fas fa-user-edit colorEdit" title="Edit this product">Edit</a>
							 
							 &nbsp;
						
							 <a th:href="@{'/product/delete/' +${product.id}}" class="fas fa-user-times colorDelete" 
							 	   title="Delete this product" th:onclick="|deleteProduct(${product.id})|">Delete</a>
						</td>
						
					</tr>
					
				</tbody>
				
			</table>
			
		</div>
		
		
		</div>
		
		
		<div class="modal" id="view-details">
 			<div class="modal-dialog modal-xl>
 				<div class="modal-content">
 					
 				</div>
 			</div>
		</div>
		
		<div th:replace="fragments :: footer"></div>
		
		<script type="text/javascript">
		
			function deleteProduct(id) {
				
					console.log("Product deleted")
					swal({
						title: "Are you sure?",
						text: "Do you want to delete this Product with ID:" + id + "?",
						icon: "warning",
						buttons: true,
						dangerMode: true,
					})
					.then((willDelete) => {
						if (willDelete) {
							window.location = "/product/delete/"+id;
						} else {
							swal("Your contact is safe!");
						}
					});
			};
			
			function clearFuntion() {
				window.location = "[[@{/products}]]";
			}
			
			$(".view-detail").on("click",function(e) {
				e.preventDefault();
				linkDetailedURL = $(this).attr("href");
				//console.log(linkDetailedURL);
				//alert(linkDetailedURL);
				$("#view-details").modal("show").find(".modal-content").load(linkDetailedURL);
			});
			
	</script>
</body>
</html>